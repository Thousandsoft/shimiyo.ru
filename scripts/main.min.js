function readJson() {
    const baseUrl = "https://raw.githubusercontent.com/centerwebpro/sunweb_projects_1/main/accepts/data.json";

    fetch(baseUrl)
        .then(response => response.json())
        .then(data => {
            setNavLinks(data);
        });

    function setNavLinks(data) {
        let navBlock = document.querySelectorAll('.topnav');
        navBlock.forEach(block => {
            if (block) {
                Object.entries(data).forEach(item => {
                    if (item[1].status == true) {
                        let navElenet = `<a href="#" class="topnav-item">${item[1].name}</a>`;
                        block.innerHTML += navElenet;
                    }
                });
            }
        });
    }
}

var products$1 = products = [
    {
        id: 1,
        price: 1925,
        title: 'Филадельфия люкс',
        description: '8 шт./350 гр.',
        oldPrice: 10000,
        img: './images/roll.svg'
    },
    {
        id: 2,
        price: 1535,
        title: 'product_2',
        description: '8 шт./350 гр.',
        oldPrice: 10000,
        img: './images/roll.svg'
    },
    {
        id: 3,
        price: 4856,
        title: 'product_3',
        description: '8 шт./350 гр.',
        oldPrice: 10000,
        img: './images/roll.svg'
    },
    {
        id: 4,
        price: 4452,
        title: 'product_4',
        description: '8 шт./350 гр.',
        oldPrice: 10000,
        img: './images/roll.svg'
    },
    {
        id: 5,
        price: 564,
        title: 'product_5',
        description: '8 шт./350 гр.',
        oldPrice: 10000,
        img: './images/roll.svg'
    },
];

var basket$1 = basket = {
    quantity: 0,
    summ: 0,
    products: [],
    add(productId) {
        let existProduct = this.products.find(item => item.id == productId);
        if (!existProduct) {
            this.products.push({
                id: productId,
                quantity: 1
            });
        } else {
            existProduct.quantity++;
        }
        this._calculateQuantity();
        this._calculateSumm();
        console.log(this.products);
    },
    _calculateQuantity() {
        this.quantity = 0;
        this.products.forEach(product => {
            this.quantity += product.quantity;
        });
        document.querySelector('.cart-label').innerHTML = this.quantity;
    },
    _calculateSumm() {
        this.summ = 0;
        this.products.forEach(product => {
            let databaseProduct = products$1.find(item => product.id == item.id);
            if (databaseProduct) {
                this.summ += parseInt(product.quantity) * parseFloat(databaseProduct.price); 
            }
        });
        document.querySelector('.cart-cost').innerHTML = this.summ;
    }
};

var products_rendering = () => {
    let cardContent = document.querySelector('.catalog_grid');
    products.forEach(product => {
        cardContent.innerHTML += `

                    <div class="catalog_grid_card">
                            <div class="catalog_grid_card_images">
                                <div class="catalog_grid_cald_types">
                                    <div class="catalog_grid_card_types-spicy">
                                        <img src="images/Spicy.svg" class="spicy-image" alt="Spicy"/>
                                        <img src="images/spicy_hover.svg" class="spicy-image_hover" alt="Spicy"/>
                                    </div>
                                    <div class="catalog_grid_card_types-hot">
                                        <img src="images/Hot.svg" class="hot-image" alt="Hot"/>
                                        <img src="images/hot_hover.svg" class="hot-image_hover" alt="Hot"/>
                                    </div>
                                    <div class="catalog_grid_card_types-vegan">
                                        <img src="images/Vegan.svg" class="vegan-image" alt="Vegan"/>
                                        <img src="images/vegan_hover.svg" class="vegan-image_hover" alt="Vegan"/>
                                    </div>  
                                </div>
                                <div class="catalog_grid_card_image">
                                    <img src="${product.img}" alt="Roll"/>
                                </div>
                            </div>
                            <div class="catalog_grid_card_information">
                                <div class="catalog_grid_card_information_title">
                                    <div class="catalog_grid_card_name">
                                    ${product.title}
                                    </div>
                                    <div class="catalog_grid_card_count">
                                    ${product.description}
                                    </div>
                                </div>
                                <div class="catalog_grid_card_cost">
                                    <div class="catalog_grid_card_cost-old">
                                        <del>${product.oldPrice}</del>
                                    </div>
                                    <button class="catalog_grid_card_cost-button" product_id="${product.id}">${product.price}</button>
                                </div>
                            </div>
                        </div>
    `;
    });
};

function storiesScroll() {
let scroll = document.querySelector('.stories');
let scrollItem = document.querySelectorAll('.story');

let left = 0;
let drag = false;
let coorX = 0;




scroll.addEventListener('mousedown', function(e) {
    drag = true;
    coorX = e.pageX - this.offsetLeft;    
});

document.addEventListener('mouseup', function(e) {
    drag = false;
    left = scroll.scrollLeft;

 });

scroll.addEventListener('mousemove', function(e) {
     if (drag) {
        this.scrollLeft = left - (e.pageX - this.offsetLeft - coorX);
    }
});

scrollItem.forEach((item) => {
    item.addEventListener('mousedown', function(e) {
        e.preventDefault();
        });
    });
}

function toggleMenu() {

  let menu = document.getElementById('menu');


  let displaySetting = menu.style.display;


  let menuButtonImage = document.getElementById('menuButtonImage');
  let bigLogoImage = document.getElementById('bigLogo');
  let mobileLogoImage = document.getElementById('mobileLogo');
  let headerStripe = document.getElementById('header_stripe');

  document.getElementById('telephone');

  let geolocationImage = document.getElementById('geo-image');
  let geolocationLabel = document.getElementById('geo-label');

  let shimingsImage = document.getElementById('shim-image');
  let shimingsLabel = document.getElementById('shim-label');

  let shopBagImage = document.getElementById('shop-bag-image');
  let costLabel = document.getElementById('cost-label');

  



  if (displaySetting == 'block') {
    
    headerStripe.style.backgroundColor = "#274646";
   
    bigLogoImage.src = "./images/logo.svg";
    mobileLogoImage.src = "./images/mobile-logo.svg";

    geolocationImage.src = "./images/location-add.svg";
    geolocationLabel.style.color = "#FFE091";

    shimingsImage.src = "./images/shimings-image.svg";
    shimingsLabel.style.color = "#FFBDC8";

    shopBagImage.src = "./images/shopping-bag.svg";
    costLabel.style.color = 'white';
    menu.style.animationName = "hideMenuAnim";
    menu.style.display = 'none';
    
    menuButtonImage.src = "./images/menu-logo.svg";

  }
  else {
    
    headerStripe.style.backgroundColor = 'white';
    menu.style.animationName = "showMenuAnim";
    menu.style.display = 'block';
    


    bigLogoImage.src = "./images/green-logo-big.svg";
    mobileLogoImage.src = "./images/mobile-logo-green.svg";

    geolocationImage.src = "./images/location-add-green.svg";
    geolocationLabel.style.color = "#006666";

    shimingsImage.src = "./images/shimings-logo-green.svg";
    shimingsLabel.style.color = "#006666";

    shopBagImage.src = "./images/shopping-bag-green.svg";
    costLabel.style.color = "#274646";

    menuButtonImage.src = "./images/cross.svg";

  }
}

function toggleMobileMenu() {

    var mobileButtonImage = document.getElementById('mobile-button-image');
    var mobileButtonText = document.getElementById('mobile-button-text');
   
    if (document.getElementById('toggle').checked) {
        mobileButtonText.style.color = "#A0A0A0";
        mobileButtonImage.src="./images/arrow-deactive.svg";
    } else {
        mobileButtonText.style.color = "#274646";
        mobileButtonImage.src="./images/arrow-active.svg";
    }
}

function showCart() {
    let cart = document.getElementById('cart');


    let displaySetting = cart.style.display;
  
    if (displaySetting == 'block') {
      
      cart.style.display = 'none';
    
    }
    else {
      cart.style.display = 'block';
  
    }
}

readJson();
products_rendering();
storiesScroll();


document.querySelectorAll('.catalog_grid_card_cost-button').forEach(item => {
    item.addEventListener('click', function (e) {
        basket$1.add(e.target.getAttribute('product_id'));
        
    });
});

var menuBtn = document.getElementById("menuButton");
menuBtn.addEventListener("click", function () {
  toggleMenu();
}, false);   

var cartBtn = document.getElementById("cart-label");
cartBtn.addEventListener("click", function () {
  showCart();
}, false); 

var btn = document.getElementById("mobile_menu_button");
btn.addEventListener("click", function() {
    toggleMobileMenu(); 
}, false);
