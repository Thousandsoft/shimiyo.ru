function readJson() {
    const baseUrl = "https://raw.githubusercontent.com/Thousandsoft/assets/main/shimiyo.json";

    fetch(baseUrl)
        .then(response => response.json())
        .then(data => {
            setNavLinks(data);
        });

    function setNavLinks(data) {
        let navBlock = document.querySelectorAll('.topnav');
        navBlock.forEach(block => {
            if (block) {
                Object.entries(data).forEach(item => {
                    if (item[1].status == true) {
                        let navElenet = `<a class="topnav-item" href="#${item[1].anchor}">${item[1].name}</a>`;
                        block.innerHTML += navElenet;
                    }
                });
            }
        });
    }
}

var products$1 = products = [
    {
        id: 1,
        price: 1925,
        title: 'Филадельфия люкс',
        description: '8 шт./350 гр.',
        oldPrice: 10000,
        img: './images/roll.svg'
    },
    {
        id: 2,
        price: 1535,
        title: 'Калифорния',
        description: '8 шт./350 гр.',
        oldPrice: 2000,
        img: './images/roll.svg'
    },
    {
        id: 3,
        price: 4856,
        title: 'Айролл',
        description: '8 шт./350 гр.',
        oldPrice: 5000,
        img: './images/roll.svg'
    },
    {
        id: 4,
        price: 4452,
        title: 'Фудзи',
        description: '8 шт./350 гр.',
        oldPrice: 10000,
        img: './images/roll.svg'
    },
    {
        id: 5,
        price: 564,
        title: 'Фри темпура',
        description: '8 шт./350 гр.',
        oldPrice: 10000,
        img: './images/roll.svg'
    },
];

//import products from "../products/products";

var basket$1 = basket = {
    quantity: 0,
    summ: 0,
    products: [],
    add(productId) {
        let existProduct = this.products.find(item => item.id == productId);
        if (!existProduct) {
            this.products.push({
                id: productId,
                quantity: 1
            });
        } else {
            existProduct.quantity++;
        }
        this._calculateQuantity();
        this._calculateSumm();
        this._setCartData(this.products);
        this._refreshCart();
    },
    _calculateQuantity() {
        this.quantity = 0;
        this.products.forEach(product => {
            this.quantity += product.quantity;
        });
        let cartLabel = document.querySelectorAll('.cart-label');
        for (let label of cartLabel) {
            label.innerHTML =  this.quantity;
        }
    },
    _calculateSumm() {
        this.summ = 0;
        this.products.forEach(product => {
            let databaseProduct = products$1.find(item => product.id == item.id);
            if (databaseProduct) {
                this.summ += parseInt(product.quantity) * parseFloat(databaseProduct.price); 
            }
        });
        let cartCost = document.querySelectorAll('.cart-cost');
        for (let cost of cartCost) {
            cost.innerHTML =  this._numberWithSpaces(this.summ);
        }
    },
    _numberWithSpaces(x) {
        return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    },

    _getCartData(){
        this.products = JSON.parse(localStorage.getItem('products') || "[]");
        if (products$1 != []){
            this._calculateQuantity();
            this._calculateSumm();
            this._refreshCart();
        }
    },
      
    _setCartData(o){
        localStorage.setItem('products', JSON.stringify(o));
        return false;
    },

    _deleteCartData(){
        localStorage.clear();
        this.products = [];
        this._calculateQuantity();
        this._calculateSumm();
        this._refreshCart();
    },

    _refreshCart() {
        let cartContent = document.querySelector('.flex-table tbody');
        cartContent.innerHTML = ``;
        this.products.forEach(product => {
            let prodFromJson = products$1.find(c => c.id == product.id);
            cartContent.innerHTML += `
            <tr>
                <td data-label="Name">${prodFromJson .title}</td>
                <td data-label="Quantity" class="cart-quantity">${product.quantity}</td>
                <td data-label="Sum" class="cart-table-price">${prodFromJson .price * product.quantity}</td>
            </tr>
        `;
        });
    }
};

var products_rendering = () => {
    let cardContent = document.querySelector('.catalog_grid');
    products.forEach(product => {
        cardContent.innerHTML += `

                    <div class="catalog_grid_card">
                            <div class="catalog_grid_card_images">
                                <div class="catalog_grid_cald_types">
                                    <div class="catalog_grid_card_types-spicy">
                                        <img src="images/Spicy.svg" class="spicy-image" alt="Spicy"/>
                                        <img src="images/spicy_hover.svg" class="spicy-image_hover" alt="Spicy"/>
                                    </div>
                                    <div class="catalog_grid_card_types-hot">
                                        <img src="images/Hot.svg" class="hot-image" alt="Hot"/>
                                        <img src="images/hot_hover.svg" class="hot-image_hover" alt="Hot"/>
                                    </div>
                                    <div class="catalog_grid_card_types-vegan">
                                        <img src="images/Vegan.svg" class="vegan-image" alt="Vegan"/>
                                        <img src="images/vegan_hover.svg" class="vegan-image_hover" alt="Vegan"/>
                                    </div>  
                                </div>
                                <div class="catalog_grid_card_image">
                                    <img src="${product.img}" alt="Roll"/>
                                </div>
                            </div>
                            <div class="catalog_grid_card_information">
                                <div class="catalog_grid_card_information_title">
                                    <div class="catalog_grid_card_name">
                                    ${product.title}
                                    </div>
                                    <div class="catalog_grid_card_count">
                                    ${product.description}
                                    </div>
                                </div>
                                <div class="catalog_grid_card_cost">
                                    <div class="catalog_grid_card_cost-old">
                                        <del>${product.oldPrice}</del>
                                    </div>
                                    <button class="catalog_grid_card_cost-button" product_id="${product.id}">${product.price}</button>
                                </div>
                            </div>
                        </div>
                        <hr class="catalog_grid_border">
    `;
    });
};

function storiesScroll() {
let scroll = document.querySelector('.stories');
let scrollItem = document.querySelectorAll('.story');

let left = 0;
let drag = false;
let coorX = 0;




scroll.addEventListener('mousedown', function(e) {
    drag = true;
    coorX = e.pageX - this.offsetLeft;    
});

document.addEventListener('mouseup', function(e) {
    drag = false;
    left = scroll.scrollLeft;

 });

scroll.addEventListener('mousemove', function(e) {
     if (drag) {
        this.scrollLeft = left - (e.pageX - this.offsetLeft - coorX);
    }
});

scrollItem.forEach((item) => {
    item.addEventListener('mousedown', function(e) {
        e.preventDefault();
        });
    });
}

function toggleMenu() {

  let menu = document.getElementById('menu');


  let displaySetting = menu.style.display;


  let menuButtonImage = document.getElementById('menuButtonImage');
  let bigLogoImage = document.getElementById('bigLogo');
  let mobileLogoImage = document.getElementById('mobileLogo');
  let headerStripe = document.getElementById('header_stripe');

  document.getElementById('telephone');

  let geolocationImage = document.getElementById('geo-image');
  let geolocationLabel = document.getElementById('geo-label');

  let shimingsImage = document.getElementById('shim-image');
  let shimingsLabel = document.getElementById('shim-label');

  let shopBagImages = document.getElementsByClassName("cart-image");
  
  let rubleSymbol = document.getElementById('cart_ruble-symbol');

  let mobileCartBackGround = document.getElementById('mobile-cart');

  let cartLabels = document.getElementsByClassName("cart-cost");
  

  
  



  if (displaySetting == 'block') {
    
    headerStripe.style.backgroundColor = "#274646";
   
    bigLogoImage.src = "./images/logo.svg";
    mobileLogoImage.src = "./images/mobile-logo.svg";

    geolocationImage.src = "./images/location-add.svg";
    geolocationLabel.style.color = "#FFE091";

    shimingsImage.src = "./images/shimings-image.svg";
    shimingsLabel.style.color = "#FFBDC8";

    for(let i = 0; i < shopBagImages.length; i++) {
      shopBagImages[i].src = "./images/shopping-bag.svg";
   }
    
    for(let i = 0; i < cartLabels.length; i++) {
      cartLabels[i].style.color = 'white';
   }
    rubleSymbol.style.color = 'white';
    menu.style.animationName = "hideMenuAnim";
    menu.style.display = 'none';
    
    menuButtonImage.src = "./images/menu-logo.svg";

    mobileCartBackGround.style.backgroundColor = "#274646";
    mobileCartBackGround.style.color = 'white';

  }
  else {
    
    headerStripe.style.backgroundColor = 'white';
    menu.style.animationName = "showMenuAnim";
    menu.style.display = 'block';
    


    bigLogoImage.src = "./images/green-logo-big.svg";
    mobileLogoImage.src = "./images/mobile-logo-green.svg";

    geolocationImage.src = "./images/location-add-green.svg";
    geolocationLabel.style.color = "#006666";

    shimingsImage.src = "./images/shimings-logo-green.svg";
    shimingsLabel.style.color = "#006666";

    for(let i = 0; i < shopBagImages.length; i++) {
      shopBagImages[i].src = "./images/shopping-bag-green.svg";
   }

    for(let i = 0; i < cartLabels.length; i++) {
      cartLabels[i].style.color = "#274646";
   }
    rubleSymbol.style.color = "#274646";

    menuButtonImage.src = "./images/cross.svg";

    mobileCartBackGround.style.backgroundColor = "#FFBDC8";
    mobileCartBackGround.style.color = "#274646";
    

  }
}

function toggleMobileMenu() {

    var mobileButtonImage = document.getElementById('mobile-button-image');
    var mobileButtonText = document.getElementById('mobile-button-text');
   
    if (document.getElementById('toggle').checked) {
        mobileButtonText.style.color = "#A0A0A0";
        mobileButtonImage.src="./images/arrow-deactive.svg";
    } else {
        mobileButtonText.style.color = "#274646";
        mobileButtonImage.src="./images/arrow-active.svg";
    }
}

function showCart() {
    let cart = document.getElementById('cart');


    let displaySetting = cart.style.display;
  
    if (displaySetting == 'block') {
      
      cart.style.display = 'none';
    
    }
    else {
      cart.style.display = 'block';
  
    }
}

function selectNavItem(e) {
    var el = document.querySelector('.active');
  
    // Check if the element exists to avoid a null syntax error on the removal
    if(el) {
      el.classList.remove('active');
    }
    
    e.target.classList.add('active');
}

readJson();
products_rendering();
storiesScroll();

//topnavSelect();

basket$1._getCartData();



document.querySelectorAll('.topnav').forEach(item => {
  item.addEventListener('click', function (e) {
    selectNavItem(e);
  });
});

document.querySelectorAll('.catalog_grid_card_cost-button').forEach(item => {
    item.addEventListener('click', function (e) {
        basket$1.add(e.target.getAttribute('product_id'));
    });
});

document.querySelectorAll('.header_cart_clear_button').forEach(item => {
  item.addEventListener('click', function (e) {
      basket$1._deleteCartData();
  });
});

var menuBtn = document.getElementById("menuButton");
menuBtn.addEventListener("click", function () {
  toggleMenu();
}, false);   

var cartBtn = document.getElementById("cart-label");
cartBtn.addEventListener("click", function () {
  showCart();
}, false); 

var btn = document.getElementById("mobile_menu_button");
btn.addEventListener("click", function() {
    toggleMobileMenu(); 
}, false);
